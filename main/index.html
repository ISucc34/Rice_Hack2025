<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productivity App</title>
    <meta name="description" content="Rice Hack 2025 main page">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header> 
        <h1>Welcome to our productivity app</h1>
    </header>
    <main>
        <!-- Main content goes here -->
        <h1>🗂️ Folders</h1>

        <!-- Chat Bubble Button -->
        <div class="chat-bubble" onclick="toggleChatPanel()">
            <span class="chat-icon">💬</span>
            <span class="chat-notification">3</span>
        </div>

        <!-- Chat Side Panel -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <div class="chat-title-section">
                    <h3>🤖 Ollama Assistant</h3>
                    <div class="chat-config">
                        <select id="modelSelector" class="model-selector">
                            <option value="llama3.2">Llama 3.2</option>
                            <option value="llama3.1">Llama 3.1</option>
                            <option value="llama2">Llama 2</option>
                            <option value="mistral">Mistral</option>
                            <option value="codellama">Code Llama</option>
                            <option value="phi3">Phi 3</option>
                        </select>
                        <div class="connection-status" id="connectionStatus">
                            <span class="status-dot"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                    </div>
                </div>
                <button class="chat-close" onclick="toggleChatPanel()">×</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    <div class="message-content">
                        🚀 Hello! I'm your AI productivity assistant powered by Ollama. Make sure Ollama is running locally on port 11434. How can I help you today?
                    </div>
                    <div class="message-time">Ready</div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
                <button class="chat-send" onclick="sendMessage()">🚀</button>
            </div>
        </div>

        <!-- Chat Panel Overlay -->
        <div class="chat-overlay" id="chatOverlay" onclick="toggleChatPanel()"></div>
        
        <div class="folder-container">
            <div class="folder-scroll-area">
                <!-- Folder 1: Work Documents -->
                <div class="folder">
                    <div class="folder-header" onclick="toggleFolder('work-folder')">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">Work Documents</span>
                        <span class="folder-arrow">▼</span>
                    </div>
                    <div class="folder-contents expanded" id="work-folder">
                        <div class="folder-contents-wrapper">
                            <a href="documents/meeting-notes.html" class="document-link">
                                📄 Meeting Notes
                            </a>
                            <a href="documents/project-plan.html" class="document-link">
                                📄 Project Plan
                            </a>
                            <a href="documents/budget.html" class="document-link">
                                📊 Budget Spreadsheet
                            </a>
                            <a href="documents/quarterly-report.html" class="document-link">
                                📈 Quarterly Report
                            </a>
                            <a href="documents/team-roster.html" class="document-link">
                                👥 Team Roster
                            </a>
                            <a href="documents/contracts.html" class="document-link">
                                📝 Contracts
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Folder 2: Personal -->
                <div class="folder">
                    <div class="folder-header" onclick="toggleFolder('personal-folder')">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">Personal</span>
                        <span class="folder-arrow">▶</span>
                    </div>
                    <div class="folder-contents" id="personal-folder">
                        <div class="folder-contents-wrapper">
                            <a href="documents/todo-list.html" class="document-link">
                                ✅ Todo List
                            </a>
                            <a href="documents/journal.html" class="document-link">
                                📝 Journal
                            </a>
                            <a href="documents/goals.html" class="document-link">
                                🎯 Goals
                            </a>
                            <a href="documents/shopping-list.html" class="document-link">
                                🛒 Shopping List
                            </a>
                            <a href="documents/workout-plan.html" class="document-link">
                                💪 Workout Plan
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Folder 3: Resources -->
                <div class="folder">
                    <div class="folder-header" onclick="toggleFolder('resources-folder')">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">Resources</span>
                        <span class="folder-arrow">▶</span>
                    </div>
                    <div class="folder-contents" id="resources-folder">
                        <div class="folder-contents-wrapper">
                            <a href="documents/bookmarks.html" class="document-link">
                                🔗 Bookmarks
                            </a>
                            <a href="documents/references.html" class="document-link">
                                📚 References
                            </a>
                            <a href="https://example.com" class="document-link" target="_blank">
                                🌐 External Link
                            </a>
                            <a href="documents/tutorials.html" class="document-link">
                                🎓 Tutorials
                            </a>
                            <a href="documents/tools.html" class="document-link">
                                � Development Tools
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Folder 4: Projects -->
                <div class="folder">
                    <div class="folder-header" onclick="toggleFolder('projects-folder')">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">Projects</span>
                        <span class="folder-arrow">▶</span>
                    </div>
                    <div class="folder-contents" id="projects-folder">
                        <div class="folder-contents-wrapper">
                            <a href="documents/rice-hack.html" class="document-link">
                                🏆 Rice Hack 2025
                            </a>
                            <a href="documents/web-app.html" class="document-link">
                                🌐 Web Application
                            </a>
                            <a href="documents/mobile-app.html" class="document-link">
                                📱 Mobile App
                            </a>
                            <a href="documents/ai-project.html" class="document-link">
                                🤖 AI Integration
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Folder 5: Archive -->
                <div class="folder">
                    <div class="folder-header" onclick="toggleFolder('archive-folder')">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">Archive</span>
                        <span class="folder-arrow">▶</span>
                    </div>
                    <div class="folder-contents" id="archive-folder">
                        <div class="folder-contents-wrapper">
                            <a href="documents/old-projects.html" class="document-link">
                                � Old Projects
                            </a>
                            <a href="documents/completed-tasks.html" class="document-link">
                                ✅ Completed Tasks
                            </a>
                            <a href="documents/archived-notes.html" class="document-link">
                                � Archived Notes
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content sections to enable scrolling -->
        <section class="scroll-content">
            <h2>📈 Productivity Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>📊 Analytics Dashboard</h3>
                    <p>Track your productivity metrics and see how you're improving over time.</p>
                </div>
                <div class="feature-card">
                    <h3>⏰ Time Management</h3>
                    <p>Set goals, track time, and optimize your workflow for maximum efficiency.</p>
                </div>
                <div class="feature-card">
                    <h3>🔗 Smart Organization</h3>
                    <p>Automatically organize your files and documents with AI-powered suggestions.</p>
                </div>
            </div>
        </section>
        
        <section class="scroll-content">
            <h2>🎯 Getting Started</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>Create Your First Folder</h4>
                    <p>Click on any folder above to start organizing your documents and files.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h4>Upload Your Files</h4>
                    <p>Drag and drop files directly into your folders or use the upload feature.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h4>Stay Organized</h4>
                    <p>Use our smart tagging and search features to find what you need quickly.</p>
                </div>
            </div>
        </section>
        
        <section class="scroll-content">
            <h2>💡 Tips & Tricks</h2>
            <div class="tips">
                <div class="tip">
                    <h4>🔍 Quick Search</h4>
                    <p>Use keyboard shortcuts to quickly find any document or folder in your workspace.</p>
                </div>
                <div class="tip">
                    <h4>🏷️ Smart Tags</h4>
                    <p>Automatically tag your files based on content and context for better organization.</p>
                </div>
                <div class="tip">
                    <h4>🔄 Sync Everywhere</h4>
                    <p>Access your files from any device with real-time synchronization.</p>
                </div>
            </div>
        </section>
        
    </main>
    <footer>
    </footer>
    
    <script>
    
        //Open clicked folder
        function toggleFolder(folderId) {
            const folderContents = document.getElementById(folderId);
            const folderHeader = folderContents.previousElementSibling;
            const arrow = folderHeader.querySelector('.folder-arrow');
            
            if (folderContents.classList.contains('expanded')) {
                folderContents.classList.remove('expanded');
                arrow.classList.remove('expanded');
                arrow.textContent = '▶';
            } else {
                folderContents.classList.add('expanded');
                arrow.classList.add('expanded');
                arrow.textContent = '▼';
            }
        }

        //Close other folders when opening a new one
        function toggleFolderExclusive(folderId) {
            // Close all folders first
            const allFolders = document.querySelectorAll('.folder-contents');
            const allArrows = document.querySelectorAll('.folder-arrow');
            
            allFolders.forEach(folder => folder.classList.remove('expanded'));
            allArrows.forEach(arrow => {
                arrow.classList.remove('expanded');
                arrow.textContent = '▶';
            });
            
            toggleFolder(folderId);
        }

        // Chat panel functions - moved to later in file with Ollama integration

        async function sendMessage() {
            const chatInput = document.querySelector('.chat-input');
            const message = chatInput.value.trim();
            
            if (message) {
                addMessage(message, 'user');
                chatInput.value = '';
                
                // Show typing indicator
                addTypingIndicator();
                
                try {
                    // Call Ollama API
                    const botResponse = await callOllama(message);
                    removeTypingIndicator();
                    addMessage(botResponse, 'bot');
                } catch (error) {
                    removeTypingIndicator();
                    addMessage('Sorry, I\'m having trouble connecting right now. Please make sure Ollama is running locally.', 'bot');
                    console.error('Ollama API error:', error);
                }
            }
        }

        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${currentTime}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message typing-indicator';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function callOllama(userMessage) {
            const modelSelector = document.getElementById('modelSelector');
            const selectedModel = modelSelector.value;
            const ollamaUrl = 'http://localhost:11434/api/generate';
            
            const requestBody = {
                model: selectedModel,
                prompt: `You are a helpful productivity assistant. Help the user with organizing files, managing tasks, and improving productivity. Be concise but informative.

User message: ${userMessage}

Response:`,
                stream: false,
                options: {
                    temperature: 0.7,
                    max_tokens: 500
                }
            };

            const response = await fetch(ollamaUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`Ollama API error: ${response.status}`);
            }

            const data = await response.json();
            return data.response || 'I apologize, but I couldn\'t generate a response.';
        }

        // Check Ollama connection status
        async function checkOllamaConnection() {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            
            try {
                const response = await fetch('http://localhost:11434/api/tags', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    statusDot.className = 'status-dot connected';
                    statusText.textContent = 'Connected';
                    
                    // Update model selector with available models
                    updateModelSelector(data.models || []);
                } else {
                    statusDot.className = 'status-dot disconnected';
                    statusText.textContent = 'Disconnected';
                }
            } catch (error) {
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Offline';
                console.log('Ollama connection check failed:', error.message);
            }
        }

        function updateModelSelector(models) {
            const modelSelector = document.getElementById('modelSelector');
            const currentValue = modelSelector.value;
            
            // Clear existing options
            modelSelector.innerHTML = '';
            
            if (models.length > 0) {
                models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.name;
                    option.textContent = model.name;
                    modelSelector.appendChild(option);
                });
                
                // Try to maintain current selection or select first available
                if (models.find(m => m.name === currentValue)) {
                    modelSelector.value = currentValue;
                } else {
                    modelSelector.value = models[0].name;
                }
            } else {
                // Fallback options if no models detected
                const defaultModels = ['llama3.2', 'llama3.1', 'mistral', 'codellama'];
                defaultModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelector.appendChild(option);
                });
                modelSelector.value = 'llama3.2';
            }
        }

        // Initialize connection check when chat panel opens
        function toggleChatPanel() {
            const chatPanel = document.getElementById('chatPanel');
            const chatOverlay = document.getElementById('chatOverlay');
            const chatBubble = document.querySelector('.chat-bubble');
            
            if (chatPanel.classList.contains('open')) {
                chatPanel.classList.remove('open');
                chatOverlay.classList.remove('active');
                chatBubble.classList.remove('active');
            } else {
                chatPanel.classList.add('open');
                chatOverlay.classList.add('active');
                chatBubble.classList.add('active');
                // Clear notification when opened
                const notification = document.querySelector('.chat-notification');
                if (notification) {
                    notification.style.display = 'none';
                }
                
                // Check Ollama connection when panel opens
                checkOllamaConnection();
            }
        }

        // Periodically check connection status
        setInterval(checkOllamaConnection, 30000); // Check every 30 seconds

        // Alternative function for streaming responses (optional)
        async function callOllamaStream(userMessage) {
            const ollamaUrl = 'http://localhost:11434/api/generate';
            
            const requestBody = {
                model: 'llama3.2',
                prompt: `You are a helpful productivity assistant. Help the user with organizing files, managing tasks, and improving productivity. 

User message: ${userMessage}

Response:`,
                stream: true,
                options: {
                    temperature: 0.7,
                    max_tokens: 500
                }
            };

            const response = await fetch(ollamaUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`Ollama API error: ${response.status}`);
            }

            // Handle streaming response
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let botMessageDiv = null;
            let fullResponse = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const chunk = decoder.decode(value);
                const lines = chunk.split('\n').filter(line => line.trim());

                for (const line of lines) {
                    try {
                        const data = JSON.parse(line);
                        if (data.response) {
                            fullResponse += data.response;
                            
                            if (!botMessageDiv) {
                                // Create initial bot message
                                removeTypingIndicator();
                                const chatMessages = document.getElementById('chatMessages');
                                botMessageDiv = document.createElement('div');
                                botMessageDiv.className = 'message bot-message';
                                const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                                botMessageDiv.innerHTML = `
                                    <div class="message-content">${fullResponse}</div>
                                    <div class="message-time">${currentTime}</div>
                                `;
                                chatMessages.appendChild(botMessageDiv);
                            } else {
                                // Update existing message
                                const messageContent = botMessageDiv.querySelector('.message-content');
                                messageContent.textContent = fullResponse;
                            }
                            
                            const chatMessages = document.getElementById('chatMessages');
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }
                    } catch (e) {
                        // Skip invalid JSON lines
                    }
                }
            }

            return fullResponse;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Scroll-based horizontal folder movement
        let currentPosition = 0;
        
        function updateFolderPosition() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
            const scrollProgress = Math.min(scrollTop / maxScroll, 1);
            
            // Calculate horizontal movement based on scroll (move folders across screen)
            const maxMovement = 600; // Maximum horizontal movement in pixels
            const targetPosition = (scrollProgress - 0.5) * maxMovement;
            
            // Smooth movement transition
            currentPosition += (targetPosition - currentPosition) * 0.1;
            
            const folders = document.querySelectorAll('.folder');
            const container = document.querySelector('.folder-container');
            
            if (folders.length >= 3) {
                // Move folders horizontally with different speeds for parallax effect
                folders[0].style.transform = `translateX(${-300 + currentPosition * 0.8}px) scale(${1 + Math.abs(currentPosition) * 0.0005})`;
                folders[1].style.transform = `translateX(${currentPosition}px) scale(${1.2 - Math.abs(currentPosition) * 0.0003})`;
                folders[2].style.transform = `translateX(${300 + currentPosition * 1.2}px) scale(${1 + Math.abs(currentPosition) * 0.0005})`;
                
                // Add rotation based on movement speed
                const rotationAmount = currentPosition * 0.2;
                folders[0].style.transform += ` rotateZ(${-rotationAmount}deg)`;
                folders[1].style.transform += ` rotateZ(${rotationAmount * 0.5}deg)`;
                folders[2].style.transform += ` rotateZ(${rotationAmount}deg)`;
            }
            
            // Move center element slightly
            if (container) {
                container.style.setProperty('--movement', `${currentPosition * 0.1}px`);
                container.style.setProperty('--rotation', `${currentPosition * 0.1}deg`);
            }
        }
        
        // Smooth scroll animation
        function animateMovement() {
            updateFolderPosition();
            requestAnimationFrame(animateMovement);
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            animateMovement();
        });
        
        // Update on scroll
        window.addEventListener('scroll', function() {
            // Throttle scroll events for better performance
            clearTimeout(window.scrollTimeout);
            window.scrollTimeout = setTimeout(updateFolderPosition, 16); // ~60fps
        });
    </script>
</body>
</html>